#------------------------------------------------------------------------------
# NVIDIA DGX SuperPOD - Production Inventory
#------------------------------------------------------------------------------
# Environment: Production
# Values are populated from group_vars/all.yml (generated from configuration.csv)
#------------------------------------------------------------------------------

all:
  vars:
    environment: prod

  children:
    #--------------------------------------------------------------------------
    # Management Nodes
    #--------------------------------------------------------------------------
    management:
      children:
        slurm_controllers:
          hosts:
            slurm-controller-01:
              ansible_host: "{{ slurm.controller_ip }}"
              slurm_role: primary
            slurm-controller-02:
              ansible_host: "{{ slurm.controller_backup_ip }}"
              slurm_role: backup
          vars:
            ansible_connection: ssh
            ansible_user: "{{ security.ssh_user | default('dgxadmin') }}"
            ansible_become: yes

        bcm_servers:
          hosts:
            bcm-server-01:
              ansible_host: "{{ bcm.server_ip }}"
          vars:
            ansible_connection: ssh
            ansible_user: "{{ security.ssh_user | default('dgxadmin') }}"
            ansible_become: yes

    #--------------------------------------------------------------------------
    # DGX Compute Nodes
    #--------------------------------------------------------------------------
    dgx_nodes:
      hosts:
        # Dynamic inventory populated from BCM or static configuration
        # Example entries (replace with actual hostnames):
        dgx-h100-01:
          ansible_host: 10.100.0.101
          gpu_count: 8
        dgx-h100-02:
          ansible_host: 10.100.0.102
          gpu_count: 8
        dgx-h100-03:
          ansible_host: 10.100.0.103
          gpu_count: 8
        dgx-h100-04:
          ansible_host: 10.100.0.104
          gpu_count: 8
        dgx-h100-05:
          ansible_host: 10.100.0.105
          gpu_count: 8
        dgx-h100-06:
          ansible_host: 10.100.0.106
          gpu_count: 8
        dgx-h100-07:
          ansible_host: 10.100.0.107
          gpu_count: 8
        dgx-h100-08:
          ansible_host: 10.100.0.108
          gpu_count: 8
      vars:
        ansible_connection: ssh
        ansible_user: "{{ security.ssh_user | default('dgxadmin') }}"
        ansible_become: yes
        ansible_network_os: linux

    #--------------------------------------------------------------------------
    # Infrastructure Services
    #--------------------------------------------------------------------------
    monitoring:
      hosts:
        prometheus-server:
          ansible_host: "{{ monitoring.prometheus_server_ip }}"
        grafana-server:
          ansible_host: "{{ monitoring.grafana_server_ip }}"
      vars:
        ansible_connection: ssh
        ansible_user: "{{ security.ssh_user | default('svcadmin') }}"
        ansible_become: yes

    mlops:
      hosts:
        mlflow-server:
          ansible_host: "{{ mlops.mlflow_server_ip }}"
      vars:
        ansible_connection: ssh
        ansible_user: "{{ security.ssh_user | default('svcadmin') }}"
        ansible_become: yes

    #--------------------------------------------------------------------------
    # InfiniBand Fabric (for UFM/SM configuration)
    #--------------------------------------------------------------------------
    infiniband:
      hosts:
        ib-subnet-manager:
          ansible_host: "{{ infiniband.subnet_manager_ip }}"
      vars:
        ansible_connection: ssh
        ansible_user: admin
        ansible_become: yes

    #--------------------------------------------------------------------------
    # Local Execution (for API calls)
    #--------------------------------------------------------------------------
    localhost:
      hosts:
        localhost:
          ansible_connection: local
          ansible_python_interpreter: "{{ ansible_playbook_python }}"
