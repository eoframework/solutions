---
#------------------------------------------------------------------------------
# Role: dnac-integration
# Purpose: Configure DNA Center integration for CI/CD automation
#------------------------------------------------------------------------------

- name: Authenticate to DNA Center
  ansible.builtin.uri:
    url: "https://{{ dnac.hostname }}/dna/system/api/v1/auth/token"
    method: POST
    user: "{{ dnac.admin_user }}"
    password: "{{ vault_dnac_admin_password }}"
    force_basic_auth: yes
    validate_certs: "{{ dnac.ssl_verify }}"
    status_code: 200
    timeout: "{{ dnac.timeout }}"
  register: dnac_auth
  no_log: true

- name: Get DNA Center system info
  ansible.builtin.uri:
    url: "https://{{ dnac.hostname }}/dna/intent/api/{{ dnac.api_version }}/network-device/count"
    method: GET
    headers:
      x-auth-token: "{{ dnac_auth.json.Token }}"
    validate_certs: "{{ dnac.ssl_verify }}"
    status_code: 200
    timeout: "{{ dnac.timeout }}"
  register: dnac_device_count

- name: Display DNA Center status
  ansible.builtin.debug:
    msg: "DNA Center managing {{ dnac_device_count.json.response }} devices"

- name: DNA Center integration complete
  ansible.builtin.debug:
    msg: "DNA Center API integration configured successfully"
